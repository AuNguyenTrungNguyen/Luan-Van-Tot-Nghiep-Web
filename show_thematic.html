<!DOCTYPE html>
<html lang="en">
<head>
    <title>Firebase</title>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.4/firebase.js"></script>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }

        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
        }
    </style>
</head>
<body>

<table>
    <tr>
        <td>mIdBlock</td>
        <td><input type="text" id="mIdBlock" size="100"></td>
    </tr>

</table>

<center><br>
    <button onclick="filter()" style="width: 50%">FILTER</button>
    <br><br></center>

<table style="width:100%" id="table_thematic">
</table>

<br>
<div id="div_detail_chapter">

    <table id="table_des_chapter">
        <th>idDES</th>
        <th>nameDes</th>
        <th>typeDes</th>
    </table>


    <table id="table_heading"></table>

    <table id="table_des_heading">
        <th>idDES</th>
        <th>nameDes</th>
        <th>typeDes</th>
    </table>


    <table id="table_title"></table>
    <table id="table_des_title"></table>

</div>

<script>
    let config = {
        apiKey: "AIzaSyAX_MCy_DNcww2hF7S8mepc17Z0_TeLE10",
        authDomain: "luanvantotnghiep-3d890.firebaseapp.com",
        databaseURL: "https://luanvantotnghiep-3d890.firebaseio.com",
        projectId: "luanvantotnghiep-3d890",
        storageBucket: "luanvantotnghiep-3d890.appspot.com",
        messagingSenderId: "470187573210"
    };
    firebase.initializeApp(config);

    let myRefCHAPTER = firebase.database().ref().child('CHAPTER');
    let myRefDESCRIPTION = firebase.database().ref().child('DESCRIPTION');
    let myRefHEADING = firebase.database().ref().child('HEADING');
    let myRefTITLE = firebase.database().ref().child('TITLE');
    let myRefDES_CHAPTER = firebase.database().ref().child('DES_CHAPTER');
    let myRefDES_HEADING = firebase.database().ref().child('DES_HEADING');
    let myRefDES_TITLE = firebase.database().ref().child('DES_TITLE');

    let chapterList = [];
    let descriptionList = [];
    let headingList = [];
    let titleList = [];
    let desOfChapterList = [];
    let desOfHeadingList = [];
    let desOfTitleList = [];

    myRefCHAPTER.once('value', function (snapshot) {
        snapshot.forEach(function (childSnapshot) {
            let chapter = childSnapshot.val();
            chapterList.push(chapter);
        });
        loadDescription();
    });

    function loadDescription() {
        myRefDESCRIPTION.once('value', function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let description = childSnapshot.val();
                descriptionList.push(description);
            });
            loadHeading()
        });
    }

    function loadHeading() {
        myRefHEADING.once('value', function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let heading = childSnapshot.val();
                headingList.push(heading);
            });
            loadTitle();
        });
    }

    function loadTitle() {
        myRefTITLE.once('value', function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let title = childSnapshot.val();
                titleList.push(title);
            });
            loadDesOfChap();
        });
    }

    function loadDesOfChap() {
        myRefDES_CHAPTER.once('value', function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let desChap = childSnapshot.val();
                desOfChapterList.push(desChap);
            });
            loadDesOfHead();
        });
    }

    function loadDesOfHead() {
        myRefDES_HEADING.once('value', function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let desHead = childSnapshot.val();
                desOfHeadingList.push(desHead);
            });
            loadDesOfTitle();
        });
    }

    function loadDesOfTitle() {
        myRefDES_TITLE.once('value', function (snapshot) {
            snapshot.forEach(function (childSnapshot) {
                let desTitle = childSnapshot.val();
                desOfTitleList.push(desTitle);
            });
            confirm("OKE rồi nhé");
        });
    }

    function filter() {

        let mIdBlock = document.getElementById("mIdBlock").value;

        //handle listTemp
        let listTemp = [];
        for (let i = 0; i < chapterList.length; i++) {
            let chapter = chapterList[i];
            if (chapter.idBlock === parseInt(mIdBlock)) {
                listTemp.push(chapter);
            }
        }

        $('#table_thematic').empty();
        let table = '';
        table += '<tr>';
        table += '<th>' + 'idChapter' + '</th>';
        table += '<th>' + 'name' + '</th>';
        $('#table_thematic').append(table);


        for (let posi = 0; posi < listTemp.length; posi++) {
            let content = '';
            content += '<tr>';
            content += '<td>' + listTemp[posi].idChapter + '</td>';
            content += '<td>' + listTemp[posi].nameChapter + '</td>';
            content += '<td>' + '<input value="CHOOSE" type="button" onClick="showDataChapter(\'' + listTemp[posi].idChapter + '\')" />' + '</td>';
            $('#table_thematic').append(content);
        }
    }

    function showDataChapter(chapter) {
        $('#table_des_chapter').empty();
        for (let i = 0; i < desOfChapterList.length; i++) {
            if (chapter === desOfChapterList[i].idChapter) {
                for (let j = 0; j < descriptionList.length; j++) {
                    if (desOfChapterList[i].idDescription === descriptionList[j].idDescription) {
                        let content = '';
                        content += '<tr>';
                        content += '<td>' + descriptionList[j].idDescription + '</td>';
                        content += '<td>' + descriptionList[j].nameDescription + '</td>';
                        content += '<td>' + descriptionList[j].idTypeOfDescription + '</td>';

                        $('#table_des_chapter').append(content);
                    }
                }
            }
        }

        $('#table_heading').empty();
        let table = '';
        table += '<tr>';
        table += '<th>' + 'idHead' + '</th>';
        table += '<th>' + 'nameHead' + '</th>';
        $('#table_heading').append(table);

        for (let i = 0; i < headingList.length; i++) {
            if (chapter === headingList[i].idChapter) {
                let content = '';
                content += '<tr>';
                content += '<td>' + headingList[i].idHeading + '</td>';
                content += '<td>' + headingList[i].nameHeading + '</td>';
                content += '<td>' + '<input value="CHOOSE" type="button" onClick="showDataHeading(\'' + headingList[i].idHeading + '\')" />' + '</td>';
                $('#table_heading').append(content);
            }
        }

    }

    function showDataHeading(heading) {
        $('#table_des_heading').empty();
        for (let i = 0; i < desOfHeadingList.length; i++) {
            if (heading === desOfHeadingList[i].idHeading) {
                for (let j = 0; j < descriptionList.length; j++) {
                    if (desOfHeadingList[i].idDescription === descriptionList[j].idDescription) {
                        let content = '';
                        content += '<tr>';
                        content += '<td>' + descriptionList[j].idDescription + '</td>';
                        content += '<td>' + descriptionList[j].nameDescription + '</td>';
                        content += '<td>' + descriptionList[j].idTypeOfDescription + '</td>';

                        $('#table_des_heading').append(content);
                    }
                }
            }
        }

        $('#table_title').empty();
        let table = '';
        table += '<tr>';
        table += '<th>' + 'idHead' + '</th>';
        table += '<th>' + 'nameHead' + '</th>';
        $('#table_title').append(table);

        for (let i = 0; i < titleList.length; i++) {
            if (heading === titleList[i].idHeading) {
                let content = '';
                content += '<tr>';
                content += '<td>' + titleList[i].idTitle + '</td>';
                content += '<td>' + titleList[i].nameTitle + '</td>';
                content += '<td>' + '<input value="CHOOSE" type="button" onClick="showDataTitle(\'' + titleList[i].idTitle + '\')" />' + '</td>';
                $('#table_title').append(content);
            }
        }
    }

    function showDataTitle(title) {
        $('#table_des_title').empty();
        let table = '';
        table += '<tr>';
        table += '<th>' + 'idDES' + '</th>';
        table += '<th>' + 'nameDes' + '</th>';
        table += '<th>' + 'typeDes' + '</th>';

        $('#table_des_title').append(table);
        for (let i = 0; i < desOfTitleList.length; i++) {
            if (title === desOfTitleList[i].idTitle) {
                for (let j = 0; j < descriptionList.length; j++) {
                    if (desOfTitleList[i].idDescription === descriptionList[j].idDescription) {
                        let content = '';
                        content += '<tr>';
                        content += '<td>' + descriptionList[j].idDescription + '</td>';
                        content += '<td>' + descriptionList[j].nameDescription + '</td>';
                        content += '<td>' + descriptionList[j].idTypeOfDescription + '</td>';

                        $('#table_des_title').append(content);
                    }
                }
            }
        }

    }

</script>
</body>
</html>