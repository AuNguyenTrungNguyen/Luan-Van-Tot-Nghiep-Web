<html lang="en">

<head>
    <title>PRODUCT BY</title>
    <meta charset="UTF-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }

        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
        }
    </style>
</head>

<body>

<center>

    <input type="button" onClick="exportData()" value="Export"/>

    <table>
        <tr>
            <td>mProduct</td>
            <td><input type="text" id="mProduct" size="50"></td>
            <td><input type="button" onClick="showID('mProduct','mProductID')" value="CheckID"/></td>
            <td><input type="text" id="mProductID" size="5" disabled></td>
        </tr>

        <tr>
            <td>mReactant1</td>
            <td><input type="text" id="mReactant1" size="50"></td>
            <td><input type="button" onClick="showID('mReactant1', 'mReactant1ID')" value="CheckID"/></td>
            <td><input type="text" id="mReactant1ID" size="5" disabled></td>
        </tr>

        <tr>
            <td>mReactant2</td>
            <td><input type="text" id="mReactant2" size="50"></td>
            <td><input type="button" onClick="showID('mReactant2', 'mReactant2ID')" value="CheckID"/></td>
            <td><input type="text" id="mReactant2ID" size="5" disabled></td>
        </tr>

        <tr>
            <td>mReactant3</td>
            <td><input type="text" id="mReactant3" size="50"></td>
            <td><input type="button" onClick="showID('mReactant3', 'mReactant3ID')" value="CheckID"/></td>
            <td><input type="text" id="mReactant3ID" size="5" disabled></td>
        </tr>

        <tr>
            <td>mReactant4</td>
            <td><input type="text" id="mReactant4" size="50"></td>
            <td><input type="button" onClick="showID('mReactant4', 'mReactant4ID')" value="CheckID"/></td>
            <td><input type="text" id="mReactant4ID" size="5" disabled></td>
        </tr>
    </table>
    <br>

    <table id="table_product_by">
    </table>

    <input type="button" onClick="saveProductBy()" value="Save"/>

</center>

<script>

    let arrayChemistry = [];
    let listProductBy = [];
    $.getJSON('chemistry.json', function (json) {
        let keyChemistry = "Chemistry";
        arrayChemistry = json[keyChemistry];
    });

    function showID(input, output) {

        let name = document.getElementById(input).value;
        let flag = false;

        for (let i = 0; i < arrayChemistry.length; i++) {
            let symbol = arrayChemistry[i].mSymbolChemistry;
            if (name === symbol) {
                document.getElementById(output).value = arrayChemistry[i].mIdChemistry;
                flag = true;
                break;
            }
        }

        if (!flag) {
            document.getElementById(output).value = "FAIL";
        }
    }

    function saveProductBy() {

        //Save data to list
        let mIdProduct = document.getElementById("mProductID").value;
        let mReactant1ID = document.getElementById("mReactant1ID").value;
        let mReactant2ID = document.getElementById("mReactant2ID").value;
        let mReactant3ID = document.getElementById("mReactant3ID").value;
        let mReactant4ID = document.getElementById("mReactant4ID").value;

        if (mIdProduct !== "" && mIdProduct !== "FAIL"){
            if (mReactant1ID !== "" && mReactant1ID !== "FAIL"){
                let data = [];
                data.push(mIdProduct);
                data.push(mReactant1ID);
                listProductBy.push(data);
            }

            if (mReactant2ID !== "" && mReactant2ID !== "FAIL"){
                let data = [];
                data.push(mIdProduct);
                data.push(mReactant2ID);
                listProductBy.push(data);
            }

            if (mReactant3ID !== "" && mReactant3ID !== "FAIL"){
                let data = [];
                data.push(mIdProduct);
                data.push(mReactant3ID);
                listProductBy.push(data);
            }

            if (mReactant4ID !== "" && mReactant4ID !== "FAIL"){
                let data = [];
                data.push(mIdProduct);
                data.push(mReactant4ID);
                listProductBy.push(data);
            }
        }

        //Show list data
        $('#table_product_by').empty();
        let table = '';
        table += '<tr>';
        table += '<th>' + 'idProduct' + '</th>';
        table += '<th>' + 'idReactant' + '</th>';
        $('#table_product_by').append(table);

        for (let i = 0; i < listProductBy.length; i++) {

            let content = '';
            content += '<tr>';
            content += '<td>' + listProductBy[i][0] + '</td>';
            content += '<td>' + listProductBy[i][1] + '</td>';
            $('#table_product_by').append(content);
        }
    }

    function exportData() {

        let csvContent = "data:text/csv;charset=utf-8,";
        listProductBy.forEach(function (rowArray) {
            let row = rowArray.join(",");
            csvContent += row + "\r\n";

        });
        let encodedUri = encodeURI(csvContent);
        let link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "my_data.csv");
        document.body.appendChild(link); // Required for FF

        link.click();
    }

</script>


</body>
</html>